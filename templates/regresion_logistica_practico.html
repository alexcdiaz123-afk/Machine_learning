{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Regresión logística — Predicción de deserción (Gimnasio)</h2>
    <small class="text-muted">Variables: frecuencia visitas, tiempo inscrito, uso clases, edad</small>
  </div>

  <div class="row">
    <!-- COL IZQUIERDA: Formulario de predicción y botones -->
    <div class="col-lg-5">
      <div class="card mb-3">
        <div class="card-body">
          <h2 class="card-title">Formulario de predicción</h2>
          <form method="post" action="{{ url_for('regresion_logistica_practico') }}">
            <div class="mb-2">
              <label class="form-label">Frecuencia de visitas (por semana)</label>
              <input name="frecuencia_visitas" class="form-control" type="number" step="0.1" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Tiempo inscrito (meses)</label>
              <input name="tiempo_inscrito" class="form-control" type="number" step="0.1" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Uso de clases grupales</label>
              <select name="uso_clases" class="form-control" required>
                <option value="Sí">Sí</option>
                <option value="No">No</option>
              </select>
            </div>

            <div class="mb-2">
              <label class="form-label">Edad</label>
              <input name="edad" class="form-control" type="number" step="1" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Threshold (0 - 1)</label>
              <input name="threshold" class="form-control" type="number" step="0.01" value="0.5" min="0" max="1">
            </div>

            <div class="d-flex gap-2">
              <button type="submit" name="action" value="predict" class="btn btn-primary">Predecir</button>
              <button type="submit" name="action" value="train" class="btn btn-success"> Evaluar</button>
            </div>

            <!-- Resultado de la predicción en badge -->
            {% if prediction_text %}
            <div class="mt-3 text-center">
              <span class="badge bg-warning text-dark fs-4 p-2">
                Predicción: {{ prediction_text }}
              </span>
            </div>
            {% endif %}
          </form>
        </div>
      </div>

      <!-- Notas sobre el dataset -->
      <div class="card">
        <div class="card-body small">
          <h3>Descripción del formulario</h3>
          <ul class="mb-0">
            <li><strong>frecuencia visitas</strong>: promedio de visitas por semana.</li>
            <li><strong>tiempo inscrito</strong>: meses de antigüedad del cliente.</li>
            <li><strong>uso clases</strong>: 'Sí' = asiste a clases grupales, 'No' = no asiste.</li>
            <li><strong>edad</strong>: edad de los clientes en años.</li>
            <li><strong>target</strong>: 1 = se da de baja; 0 = permanece.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- COL DERECHA: Métricas, reporte y matriz -->
    <div class="col-lg-7">
      <div class="row g-3">
        <!-- Card Exactitud -->
        <div class="col-md-6">
          <div class="card text-center">
            <div class="card-body">
              <h3 class="card-subtitle mb-2 text-muted">Exactitud</h3>
              {% if metrics %}
                <p class="display-6 mb-0">{{ metrics.accuracy if metrics.accuracy is defined else metrics['accuracy'] }}</p>
              {% else %}
                <p class="text-muted mb-0">Rellena el formulario y da click en evaluar</p>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Card info adicional -->
        <div class="col-md-6">
          <div class="card text-center">
            <div class="card-body">
              <h3 class="card-subtitle mb-2 text-muted">Observaciones</h3>
              <p class="mb-0 small">Despues de rellenar el formulario da click en <strong> Evaluar</strong> para obtener métricas y matriz.</p>
            </div>
          </div>
        </div>

        <!-- Reporte de clasificación -->
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <h3>Reporte de clasificación</h3>
              {% if report_html %}
                <div class="table-responsive">{{ report_html|safe }}</div>
              {% else %}
                <p class="text-muted">No hay reporte disponible, rellena el formulario.</p>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Matriz de confusión -->
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <h3>Matriz de confusión</h3>
              {% if cm_img %}
                <img src="{{ cm_img }}" alt="Matriz de confusión" class="img-fluid border">
                <p class="small text-muted mt-2">Filas = reales (0/1) — Columnas = predichos (0/1)</p>
              {% else %}
                <p class="text-muted">No hay imagen. Rellena el formulario para generarla.</p>
              {% endif %}
            </div>
          </div>
        </div>

      </div><!-- /row metrics -->
    </div><!-- /col derecha -->
  </div><!-- /row principal -->
</div>
{% endblock %}
